#include <string.h>
#include <tau/tau.h>

#include "milenage.h"
#include "src/milenage.c"

milenage_st const milenage_param_default = {
    .c1 = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
           0x00, 0x00, 0x00, 0x00, 0x00},
    .c2 = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
           0x00, 0x00, 0x00, 0x00, 0x01},
    .c3 = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
           0x00, 0x00, 0x00, 0x00, 0x02},
    .c4 = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
           0x00, 0x00, 0x00, 0x00, 0x04},
    .c5 = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
           0x00, 0x00, 0x00, 0x00, 0x08},
    .r1 = 64,
    .r2 = 0,
    .r3 = 32,
    .r4 = 64,
    .r5 = 96,
};

#define F1F1STAR_TEST_SET(op, k, rand, sqn, amf, exp_mac_a, exp_mac_s)         \
    do                                                                         \
    {                                                                          \
        milenage_st milenage_param;                                            \
        memcpy(&milenage_param, &milenage_param_default,                       \
               sizeof(milenage_param));                                        \
        memcpy(milenage_param.op, op, sizeof(milenage_param.op));              \
        milenage_param.op_present = true;                                      \
        uint8_t mac_a[8];                                                      \
        f1(&milenage_param, k, rand, sqn, amf, mac_a);                         \
        CHECK_BUF_EQ(mac_a, exp_mac_a, sizeof(mac_a));                         \
        uint8_t mac_s[8];                                                      \
        f1star(&milenage_param, k, rand, sqn, amf, mac_s);                     \
        CHECK_BUF_EQ(mac_s, exp_mac_s, sizeof(mac_s));                         \
    } while (0)

#define F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5)                   \
    do                                                                         \
    {                                                                          \
        milenage_st milenage_param;                                            \
        memcpy(&milenage_param, &milenage_param_default,                       \
               sizeof(milenage_param));                                        \
        memcpy(milenage_param.op, op, sizeof(milenage_param.op));              \
        milenage_param.op_present = true;                                      \
        uint8_t output_f2[8];                                                  \
        f2(&milenage_param, k, rand, output_f2);                               \
        CHECK_BUF_EQ(output_f2, exp_f2, sizeof(output_f2));                    \
        uint8_t output_f3[16];                                                 \
        f3(&milenage_param, k, rand, output_f3);                               \
        CHECK_BUF_EQ(output_f3, exp_f3, sizeof(output_f3));                    \
        uint8_t output_f5[6];                                                  \
        f5(&milenage_param, k, rand, output_f5);                               \
        CHECK_BUF_EQ(output_f5, exp_f5, sizeof(output_f5));                    \
    } while (0)

#define F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star)                     \
    do                                                                         \
    {                                                                          \
        milenage_st milenage_param;                                            \
        memcpy(&milenage_param, &milenage_param_default,                       \
               sizeof(milenage_param));                                        \
        memcpy(milenage_param.op, op, sizeof(milenage_param.op));              \
        milenage_param.op_present = true;                                      \
        uint8_t output_f4[16];                                                 \
        f4(&milenage_param, k, rand, output_f4);                               \
        CHECK_BUF_EQ(output_f4, exp_f4, sizeof(output_f4));                    \
        uint8_t output_f5star[6];                                              \
        f5star(&milenage_param, k, rand, output_f5star);                       \
        CHECK_BUF_EQ(output_f5star, exp_f5star, sizeof(output_f5star));        \
    } while (0)

#define MILENAGE_TEST_SET(op_c, k, rand, sqn, amf, exp_f1, exp_f1star, exp_f2, \
                          exp_f3, exp_f4, exp_f5, exp_f5star)                  \
    do                                                                         \
    {                                                                          \
        milenage_st milenage_param;                                            \
        memcpy(&milenage_param, &milenage_param_default,                       \
               sizeof(milenage_param));                                        \
        memcpy(milenage_param.op_c, op_c, sizeof(milenage_param.op));          \
        milenage_param.op_present = false;                                     \
        uint8_t output[16];                                                    \
        f1(&milenage_param, k, rand, sqn, amf, output);                        \
        CHECK_BUF_EQ(output, exp_f1, sizeof(exp_f1));                          \
        f1star(&milenage_param, k, rand, sqn, amf, output);                    \
        CHECK_BUF_EQ(output, exp_f1star, sizeof(exp_f1star));                  \
        f2(&milenage_param, k, rand, output);                                  \
        CHECK_BUF_EQ(output, exp_f2, sizeof(exp_f2));                          \
        f3(&milenage_param, k, rand, output);                                  \
        CHECK_BUF_EQ(output, exp_f3, sizeof(exp_f3));                          \
        f4(&milenage_param, k, rand, output);                                  \
        CHECK_BUF_EQ(output, exp_f4, sizeof(exp_f4));                          \
        f5(&milenage_param, k, rand, output);                                  \
        CHECK_BUF_EQ(output, exp_f5, sizeof(exp_f5));                          \
        f5star(&milenage_param, k, rand, output);                              \
        CHECK_BUF_EQ(output, exp_f5star, sizeof(exp_f5star));                  \
    } while (0)

TEST(milenage, xorv_16byte)
{
    uint8_t const a[16] = {
        0xFF, 0x10, 0xE4, 0xEE, 0xAB, 0xD6, 0x84, 0xBD,
        0x59, 0x78, 0x52, 0x06, 0xDA, 0x04, 0x8B, 0xE3,
    };
    uint8_t const b[16] = {
        0x39, 0xBA, 0x92, 0x46, 0x3B, 0x3F, 0xB4, 0x1A,
        0xEC, 0xCB, 0xBE, 0xB7, 0xBF, 0x62, 0xF4, 0x1C,
    };
    uint8_t const axorb[16] = {
        0xC6, 0xAA, 0x76, 0xA8, 0x90, 0xE9, 0x30, 0xA7,
        0xB5, 0xB3, 0xEC, 0xB1, 0x65, 0x66, 0x7F, 0xFF,
    };
    uint8_t output[16] = {0};
    xorv(a, b, 16, output);
    CHECK_BUF_EQ(output, axorb, 16);
}

TEST(milenage, xorv_zero)
{
    uint8_t const a[16] = {
        0xA8, 0xD1, 0xFB, 0x60, 0x52, 0xA9, 0x59, 0xED,
        0xB8, 0x7B, 0xF2, 0x64, 0x47, 0x4F, 0x91, 0x75,
    };
    uint8_t const zero[16] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };
    uint8_t output[16] = {0};
    xorv(a, zero, 16, output);
    CHECK_BUF_EQ(output, a, 16);
}

TEST(milenage, xorv_len_variable)
{
    uint8_t const a[16] = {
        0x91, 0x80, 0x0E, 0xC9, 0xB7, 0x8C, 0xAC, 0x78,
        0x7C, 0x36, 0xCA, 0x7A, 0xA8, 0xD6, 0x7D, 0x80,
    };
    uint8_t const b[16] = {
        0x18, 0xFA, 0x5F, 0xB3, 0x25, 0x45, 0xA5, 0x2C,
        0x50, 0x3F, 0xBA, 0xE9, 0x03, 0xBD, 0xB4, 0xAA,
    };
    uint8_t const axorb[16] = {
        0x89, 0x7A, 0x51, 0x7A, 0x92, 0xC9, 0x09, 0x54,
        0x2C, 0x09, 0x70, 0x93, 0xAB, 0x6B, 0xC9, 0x2A,
    };
    uint8_t output[16] = {0};
    for (uint8_t i = 1; i < 16; ++i)
    {
        xorv(a, b, i, output);
        CHECK_BUF_EQ(output, axorb, i);
    }
}

TEST(milenage, rotl128_full_byte)
{
    uint8_t const n_const[16] = {
        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
        0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
    };
    uint8_t const n_rotl[16][16] = {
        {0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB,
         0xCC, 0xDD, 0xEE, 0xFF},
        {0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC,
         0xDD, 0xEE, 0xFF, 0x00},
        {0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD,
         0xEE, 0xFF, 0x00, 0x11},
        {0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE,
         0xFF, 0x00, 0x11, 0x22},
        {0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
         0x00, 0x11, 0x22, 0x33},
        {0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00,
         0x11, 0x22, 0x33, 0x44},
        {0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11,
         0x22, 0x33, 0x44, 0x55},
        {0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22,
         0x33, 0x44, 0x55, 0x66},
        {0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33,
         0x44, 0x55, 0x66, 0x77},
        {0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44,
         0x55, 0x66, 0x77, 0x88},
        {0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55,
         0x66, 0x77, 0x88, 0x99},
        {0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66,
         0x77, 0x88, 0x99, 0xAA},
        {0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
         0x88, 0x99, 0xAA, 0xBB},
        {0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88,
         0x99, 0xAA, 0xBB, 0xCC},
        {0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99,
         0xAA, 0xBB, 0xCC, 0xDD},
        {0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA,
         0xBB, 0xCC, 0xDD, 0xEE},
    };
    for (uint8_t i = 0; i < 16; ++i)
    {
        uint8_t n[16];
        memcpy(n, n_const, 16);
        rotl128(n, i * 8);
        CHECK_BUF_EQ(n, n_rotl[i], 16);
    }
}

TEST(milenage, rotl128_partial_byte)
{
    uint8_t const n_const[16] = {
        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
        0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
    };
    uint8_t const n_rotr_11[16] = {
        0x42, 0x64, 0x86, 0xA8, 0xCA, 0xEC, 0x0E, 0x31,
        0x53, 0x75, 0x97, 0xB9, 0xDB, 0xFD, 0x1F, 0x20,
    };

    uint8_t n[16];
    memcpy(n, n_const, 16);
    rotl128(n, 11);
    CHECK_BUF_EQ(n, n_rotr_11, 16);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_1)
{
    uint8_t const op[16] = {
        0xCD, 0xC2, 0x02, 0xD5, 0x12, 0x3E, 0x20, 0xF6,
        0x2B, 0x6D, 0x67, 0x6A, 0xC7, 0x2C, 0xB3, 0x18,
    };
    uint8_t const k[16] = {
        0x46, 0x5B, 0x5C, 0xE8, 0xB1, 0x99, 0xB4, 0x9F,
        0xAA, 0x5F, 0x0A, 0x2E, 0xE2, 0x38, 0xA6, 0xBC,
    };
    uint8_t const rand[16] = {
        0x23, 0x55, 0x3C, 0xBE, 0x96, 0x37, 0xA8, 0x9D,
        0x21, 0x8A, 0xE6, 0x4D, 0xAE, 0x47, 0xBF, 0x35,
    };
    uint8_t const sqn[6] = {
        0xFF, 0x9B, 0xB4, 0xD0, 0xB6, 0x07,
    };
    uint8_t const amf[2] = {
        0xB9,
        0xB9,
    };
    uint8_t const mac_a_exp[8] = {
        0x4A, 0x9F, 0xFA, 0xC3, 0x54, 0xDF, 0xAF, 0xB3,
    };
    uint8_t const mac_s_exp[8] = {
        0x01, 0xCF, 0xAF, 0x9E, 0xC4, 0xE8, 0x71, 0xE9,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_2)
{
    uint8_t const op[16] = {
        0xFF, 0x53, 0xBA, 0xDE, 0x17, 0xDF, 0x5D, 0x4E,
        0x79, 0x30, 0x73, 0xCE, 0x9D, 0x75, 0x79, 0xFA,
    };
    uint8_t const k[16] = {
        0x03, 0x96, 0xEB, 0x31, 0x7B, 0x6D, 0x1C, 0x36,
        0xF1, 0x9C, 0x1C, 0x84, 0xCD, 0x6F, 0xFD, 0x16,
    };
    uint8_t const rand[16] = {
        0xC0, 0x0D, 0x60, 0x31, 0x03, 0xDC, 0xEE, 0x52,
        0xC4, 0x47, 0x81, 0x19, 0x49, 0x42, 0x02, 0xE8,
    };
    uint8_t const sqn[6] = {
        0xFD, 0x8E, 0xEF, 0x40, 0xDF, 0x7D,
    };
    uint8_t const amf[2] = {
        0xAF,
        0x17,
    };
    uint8_t const mac_a_exp[8] = {
        0x5D, 0xF5, 0xB3, 0x18, 0x07, 0xE2, 0x58, 0xB0,
    };
    uint8_t const mac_s_exp[8] = {
        0xA8, 0xC0, 0x16, 0xE5, 0x1E, 0xF4, 0xA3, 0x43,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_3)
{
    uint8_t const op[16] = {
        0xDB, 0xC5, 0x9A, 0xDC, 0xB6, 0xF9, 0xA0, 0xEF,
        0x73, 0x54, 0x77, 0xB7, 0xFA, 0xDF, 0x83, 0x74,
    };
    uint8_t const k[16] = {
        0xFE, 0xC8, 0x6B, 0xA6, 0xEB, 0x70, 0x7E, 0xD0,
        0x89, 0x05, 0x75, 0x7B, 0x1B, 0xB4, 0x4B, 0x8F,
    };
    uint8_t const rand[16] = {
        0x9F, 0x7C, 0x8D, 0x02, 0x1A, 0xCC, 0xF4, 0xDB,
        0x21, 0x3C, 0xCF, 0xF0, 0xC7, 0xF7, 0x1A, 0x6A,
    };
    uint8_t const sqn[6] = {
        0x9D, 0x02, 0x77, 0x59, 0x5F, 0xFC,
    };
    uint8_t const amf[2] = {
        0x72,
        0x5C,
    };
    uint8_t const mac_a_exp[8] = {
        0x9C, 0xAB, 0xC3, 0xE9, 0x9B, 0xAF, 0x72, 0x81,
    };
    uint8_t const mac_s_exp[8] = {
        0x95, 0x81, 0x4B, 0xA2, 0xB3, 0x04, 0x43, 0x24,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_4)
{
    uint8_t const op[16] = {
        0x22, 0x30, 0x14, 0xC5, 0x80, 0x66, 0x94, 0xC0,
        0x07, 0xCA, 0x1E, 0xEE, 0xF5, 0x7F, 0x00, 0x4F,
    };
    uint8_t const k[16] = {
        0x9E, 0x59, 0x44, 0xAE, 0xA9, 0x4B, 0x81, 0x16,
        0x5C, 0x82, 0xFB, 0xF9, 0xF3, 0x2D, 0xB7, 0x51,
    };
    uint8_t const rand[16] = {
        0xCE, 0x83, 0xDB, 0xC5, 0x4A, 0xC0, 0x27, 0x4A,
        0x15, 0x7C, 0x17, 0xF8, 0x0D, 0x01, 0x7B, 0xD6,
    };
    uint8_t const sqn[6] = {
        0x0B, 0x60, 0x4A, 0x81, 0xEC, 0xA8,
    };
    uint8_t const amf[2] = {
        0x9E,
        0x09,
    };
    uint8_t const mac_a_exp[8] = {
        0x74, 0xA5, 0x82, 0x20, 0xCB, 0xA8, 0x4C, 0x49,
    };
    uint8_t const mac_s_exp[8] = {
        0xAC, 0x2C, 0xC7, 0x4A, 0x96, 0x87, 0x18, 0x37,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_5)
{
    uint8_t const op[16] = {
        0x2D, 0x16, 0xC5, 0xCD, 0x1F, 0xDF, 0x6B, 0x22,
        0x38, 0x35, 0x84, 0xE3, 0xBE, 0xF2, 0xA8, 0xD8,
    };
    uint8_t const k[16] = {
        0x4A, 0xB1, 0xDE, 0xB0, 0x5C, 0xA6, 0xCE, 0xB0,
        0x51, 0xFC, 0x98, 0xE7, 0x7D, 0x02, 0x6A, 0x84,
    };
    uint8_t const rand[16] = {
        0x74, 0xB0, 0xCD, 0x60, 0x31, 0xA1, 0xC8, 0x33,
        0x9B, 0x2B, 0x6C, 0xE2, 0xB8, 0xC4, 0xA1, 0x86,
    };
    uint8_t const sqn[6] = {
        0xE8, 0x80, 0xA1, 0xB5, 0x80, 0xB6,
    };
    uint8_t const amf[2] = {
        0x9F,
        0x07,
    };
    uint8_t const mac_a_exp[8] = {
        0x49, 0xE7, 0x85, 0xDD, 0x12, 0x62, 0x6E, 0xF2,
    };
    uint8_t const mac_s_exp[8] = {
        0x9E, 0x85, 0x79, 0x03, 0x36, 0xBB, 0x3F, 0xA2,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f1_f1star__3gpp_ts_35_207_v17_0_0__test_set_6)
{
    uint8_t const op[16] = {
        0x1B, 0xA0, 0x0A, 0x1A, 0x7C, 0x67, 0x00, 0xAC,
        0x8C, 0x3F, 0xF3, 0xE9, 0x6A, 0xD0, 0x87, 0x25,
    };
    uint8_t const k[16] = {
        0x6C, 0x38, 0xA1, 0x16, 0xAC, 0x28, 0x0C, 0x45,
        0x4F, 0x59, 0x33, 0x2E, 0xE3, 0x5C, 0x8C, 0x4F,
    };
    uint8_t const rand[16] = {
        0xEE, 0x64, 0x66, 0xBC, 0x96, 0x20, 0x2C, 0x5A,
        0x55, 0x7A, 0xBB, 0xEF, 0xF8, 0xBA, 0xBF, 0x63,
    };
    uint8_t const sqn[6] = {
        0x41, 0x4B, 0x98, 0x22, 0x21, 0x81,
    };
    uint8_t const amf[2] = {
        0x44,
        0x64,
    };
    uint8_t const mac_a_exp[8] = {
        0x07, 0x8A, 0xDF, 0xB4, 0x88, 0x24, 0x1A, 0x57,
    };
    uint8_t const mac_s_exp[8] = {
        0x80, 0x24, 0x6B, 0x8D, 0x01, 0x86, 0xBC, 0xF1,
    };
    F1F1STAR_TEST_SET(op, k, rand, sqn, amf, mac_a_exp, mac_s_exp);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_1)
{
    uint8_t const op[16] = {
        0xCD, 0xC2, 0x02, 0xD5, 0x12, 0x3E, 0x20, 0xF6,
        0x2B, 0x6D, 0x67, 0x6A, 0xC7, 0x2C, 0xB3, 0x18,
    };
    uint8_t const k[16] = {
        0x46, 0x5B, 0x5C, 0xE8, 0xB1, 0x99, 0xB4, 0x9F,
        0xAA, 0x5F, 0x0A, 0x2E, 0xE2, 0x38, 0xA6, 0xBC,
    };
    uint8_t const rand[16] = {
        0x23, 0x55, 0x3C, 0xBE, 0x96, 0x37, 0xA8, 0x9D,
        0x21, 0x8A, 0xE6, 0x4D, 0xAE, 0x47, 0xBF, 0x35,
    };
    uint8_t const exp_f2[8] = {
        0xA5, 0x42, 0x11, 0xD5, 0xE3, 0xBA, 0x50, 0xBF,
    };
    uint8_t const exp_f3[16] = {
        0xB4, 0x0B, 0xA9, 0xA3, 0xC5, 0x8B, 0x2A, 0x05,
        0xBB, 0xF0, 0xD9, 0x87, 0xB2, 0x1B, 0xF8, 0xCB,
    };
    uint8_t const exp_f5[6] = {
        0xAA, 0x68, 0x9C, 0x64, 0x83, 0x70,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_2)
{
    uint8_t const op[16] = {
        0xFF, 0x53, 0xBA, 0xDE, 0x17, 0xDF, 0x5D, 0x4E,
        0x79, 0x30, 0x73, 0xCE, 0x9D, 0x75, 0x79, 0xFA,
    };
    uint8_t const k[16] = {
        0x03, 0x96, 0xEB, 0x31, 0x7B, 0x6D, 0x1C, 0x36,
        0xF1, 0x9C, 0x1C, 0x84, 0xCD, 0x6F, 0xFD, 0x16,
    };
    uint8_t const rand[16] = {
        0xC0, 0x0D, 0x60, 0x31, 0x03, 0xDC, 0xEE, 0x52,
        0xC4, 0x47, 0x81, 0x19, 0x49, 0x42, 0x02, 0xE8,
    };
    uint8_t const exp_f2[8] = {
        0xD3, 0xA6, 0x28, 0xED, 0x98, 0x86, 0x20, 0xF0,
    };
    uint8_t const exp_f3[16] = {
        0x58, 0xC4, 0x33, 0xFF, 0x7A, 0x70, 0x82, 0xAC,
        0xD4, 0x24, 0x22, 0x0F, 0x2B, 0x67, 0xC5, 0x56,
    };
    uint8_t const exp_f5[6] = {
        0xC4, 0x77, 0x83, 0x99, 0x5F, 0x72,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_3)
{
    uint8_t const op[16] = {
        0xDB, 0xC5, 0x9A, 0xDC, 0xB6, 0xF9, 0xA0, 0xEF,
        0x73, 0x54, 0x77, 0xB7, 0xFA, 0xDF, 0x83, 0x74,
    };
    uint8_t const k[16] = {
        0xFE, 0xC8, 0x6B, 0xA6, 0xEB, 0x70, 0x7E, 0xD0,
        0x89, 0x05, 0x75, 0x7B, 0x1B, 0xB4, 0x4B, 0x8F,
    };
    uint8_t const rand[16] = {
        0x9F, 0x7C, 0x8D, 0x02, 0x1A, 0xCC, 0xF4, 0xDB,
        0x21, 0x3C, 0xCF, 0xF0, 0xC7, 0xF7, 0x1A, 0x6A,
    };
    uint8_t const exp_f2[8] = {
        0x80, 0x11, 0xC4, 0x8C, 0x0C, 0x21, 0x4E, 0xD2,
    };
    uint8_t const exp_f3[16] = {
        0x5D, 0xBD, 0xBB, 0x29, 0x54, 0xE8, 0xF3, 0xCD,
        0xE6, 0x65, 0xB0, 0x46, 0x17, 0x9A, 0x50, 0x98,
    };
    uint8_t const exp_f5[6] = {
        0x33, 0x48, 0x4D, 0xC2, 0x13, 0x6B,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_4)
{
    uint8_t const op[16] = {
        0x22, 0x30, 0x14, 0xC5, 0x80, 0x66, 0x94, 0xC0,
        0x07, 0xCA, 0x1E, 0xEE, 0xF5, 0x7F, 0x00, 0x4F,
    };
    uint8_t const k[16] = {
        0x9E, 0x59, 0x44, 0xAE, 0xA9, 0x4B, 0x81, 0x16,
        0x5C, 0x82, 0xFB, 0xF9, 0xF3, 0x2D, 0xB7, 0x51,
    };
    uint8_t const rand[16] = {
        0xCE, 0x83, 0xDB, 0xC5, 0x4A, 0xC0, 0x27, 0x4A,
        0x15, 0x7C, 0x17, 0xF8, 0x0D, 0x01, 0x7B, 0xD6,
    };
    uint8_t const exp_f2[8] = {
        0xF3, 0x65, 0xCD, 0x68, 0x3C, 0xD9, 0x2E, 0x96,
    };
    uint8_t const exp_f3[16] = {
        0xE2, 0x03, 0xED, 0xB3, 0x97, 0x15, 0x74, 0xF5,
        0xA9, 0x4B, 0x0D, 0x61, 0xB8, 0x16, 0x34, 0x5D,
    };
    uint8_t const exp_f5[6] = {
        0xF0, 0xB9, 0xC0, 0x8A, 0xD0, 0x2E,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_5)
{
    uint8_t const op[16] = {
        0x2D, 0x16, 0xC5, 0xCD, 0x1F, 0xDF, 0x6B, 0x22,
        0x38, 0x35, 0x84, 0xE3, 0xBE, 0xF2, 0xA8, 0xD8,
    };
    uint8_t const k[16] = {
        0x4A, 0xB1, 0xDE, 0xB0, 0x5C, 0xA6, 0xCE, 0xB0,
        0x51, 0xFC, 0x98, 0xE7, 0x7D, 0x02, 0x6A, 0x84,
    };
    uint8_t const rand[16] = {
        0x74, 0xB0, 0xCD, 0x60, 0x31, 0xA1, 0xC8, 0x33,
        0x9B, 0x2B, 0x6C, 0xE2, 0xB8, 0xC4, 0xA1, 0x86,
    };
    uint8_t const exp_f2[8] = {
        0x58, 0x60, 0xFC, 0x1B, 0xCE, 0x35, 0x1E, 0x7E,
    };
    uint8_t const exp_f3[16] = {
        0x76, 0x57, 0x76, 0x6B, 0x37, 0x3D, 0x1C, 0x21,
        0x38, 0xF3, 0x07, 0xE3, 0xDE, 0x92, 0x42, 0xF9,
    };
    uint8_t const exp_f5[6] = {
        0x31, 0xE1, 0x1A, 0x60, 0x91, 0x18,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f2_f3_f5__3gpp_ts_35_207_v17_0_0__test_set_6)
{
    uint8_t const op[16] = {
        0x1B, 0xA0, 0x0A, 0x1A, 0x7C, 0x67, 0x00, 0xAC,
        0x8C, 0x3F, 0xF3, 0xE9, 0x6A, 0xD0, 0x87, 0x25,
    };
    uint8_t const k[16] = {
        0x6C, 0x38, 0xA1, 0x16, 0xAC, 0x28, 0x0C, 0x45,
        0x4F, 0x59, 0x33, 0x2E, 0xE3, 0x5C, 0x8C, 0x4F,
    };
    uint8_t const rand[16] = {
        0xEE, 0x64, 0x66, 0xBC, 0x96, 0x20, 0x2C, 0x5A,
        0x55, 0x7A, 0xBB, 0xEF, 0xF8, 0xBA, 0xBF, 0x63,
    };
    uint8_t const exp_f2[8] = {
        0x16, 0xC8, 0x23, 0x3F, 0x05, 0xA0, 0xAC, 0x28,
    };
    uint8_t const exp_f3[16] = {
        0x3F, 0x8C, 0x75, 0x87, 0xFE, 0x8E, 0x4B, 0x23,
        0x3A, 0xF6, 0x76, 0xAE, 0xDE, 0x30, 0xBA, 0x3B,
    };
    uint8_t const exp_f5[6] = {
        0x45, 0xB0, 0xF6, 0x9A, 0xB0, 0x6C,
    };
    F2F3F5_TEST_SET(op, k, rand, exp_f2, exp_f3, exp_f5);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_1)
{
    uint8_t const op[16] = {
        0xCD, 0xC2, 0x02, 0xD5, 0x12, 0x3E, 0x20, 0xF6,
        0x2B, 0x6D, 0x67, 0x6A, 0xC7, 0x2C, 0xB3, 0x18,
    };
    uint8_t const k[16] = {
        0x46, 0x5B, 0x5C, 0xE8, 0xB1, 0x99, 0xB4, 0x9F,
        0xAA, 0x5F, 0x0A, 0x2E, 0xE2, 0x38, 0xA6, 0xBC,
    };
    uint8_t const rand[16] = {
        0x23, 0x55, 0x3C, 0xBE, 0x96, 0x37, 0xA8, 0x9D,
        0x21, 0x8A, 0xE6, 0x4D, 0xAE, 0x47, 0xBF, 0x35,
    };
    uint8_t const exp_f4[16] = {
        0xF7, 0x69, 0xBC, 0xD7, 0x51, 0x04, 0x46, 0x04,
        0x12, 0x76, 0x72, 0x71, 0x1C, 0x6D, 0x34, 0x41,
    };
    uint8_t const exp_f5star[6] = {
        0x45, 0x1E, 0x8B, 0xEC, 0xA4, 0x3B,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_2)
{
    uint8_t const op[16] = {
        0xFF, 0x53, 0xBA, 0xDE, 0x17, 0xDF, 0x5D, 0x4E,
        0x79, 0x30, 0x73, 0xCE, 0x9D, 0x75, 0x79, 0xFA,
    };
    uint8_t const k[16] = {
        0x03, 0x96, 0xEB, 0x31, 0x7B, 0x6D, 0x1C, 0x36,
        0xF1, 0x9C, 0x1C, 0x84, 0xCD, 0x6F, 0xFD, 0x16,
    };
    uint8_t const rand[16] = {
        0xC0, 0x0D, 0x60, 0x31, 0x03, 0xDC, 0xEE, 0x52,
        0xC4, 0x47, 0x81, 0x19, 0x49, 0x42, 0x02, 0xE8,
    };
    uint8_t const exp_f4[16] = {
        0x21, 0xA8, 0xC1, 0xF9, 0x29, 0x70, 0x2A, 0xDB,
        0x3E, 0x73, 0x84, 0x88, 0xB9, 0xF5, 0xC5, 0xDA,
    };
    uint8_t const exp_f5star[6] = {
        0x30, 0xF1, 0x19, 0x70, 0x61, 0xC1,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_3)
{
    uint8_t const op[16] = {
        0xDB, 0xC5, 0x9A, 0xDC, 0xB6, 0xF9, 0xA0, 0xEF,
        0x73, 0x54, 0x77, 0xB7, 0xFA, 0xDF, 0x83, 0x74,
    };
    uint8_t const k[16] = {
        0xFE, 0xC8, 0x6B, 0xA6, 0xEB, 0x70, 0x7E, 0xD0,
        0x89, 0x05, 0x75, 0x7B, 0x1B, 0xB4, 0x4B, 0x8F,
    };
    uint8_t const rand[16] = {
        0x9F, 0x7C, 0x8D, 0x02, 0x1A, 0xCC, 0xF4, 0xDB,
        0x21, 0x3C, 0xCF, 0xF0, 0xC7, 0xF7, 0x1A, 0x6A,
    };
    uint8_t const exp_f4[16] = {
        0x59, 0xA9, 0x2D, 0x3B, 0x47, 0x6A, 0x04, 0x43,
        0x48, 0x70, 0x55, 0xCF, 0x88, 0xB2, 0x30, 0x7B,
    };
    uint8_t const exp_f5star[6] = {
        0xDE, 0xAC, 0xDD, 0x84, 0x8C, 0xC6,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_4)
{
    uint8_t const op[16] = {
        0x22, 0x30, 0x14, 0xC5, 0x80, 0x66, 0x94, 0xC0,
        0x07, 0xCA, 0x1E, 0xEE, 0xF5, 0x7F, 0x00, 0x4F,
    };
    uint8_t const k[16] = {
        0x9E, 0x59, 0x44, 0xAE, 0xA9, 0x4B, 0x81, 0x16,
        0x5C, 0x82, 0xFB, 0xF9, 0xF3, 0x2D, 0xB7, 0x51,
    };
    uint8_t const rand[16] = {
        0xCE, 0x83, 0xDB, 0xC5, 0x4A, 0xC0, 0x27, 0x4A,
        0x15, 0x7C, 0x17, 0xF8, 0x0D, 0x01, 0x7B, 0xD6,
    };
    uint8_t const exp_f4[16] = {
        0x0C, 0x45, 0x24, 0xAD, 0xEA, 0xC0, 0x41, 0xC4,
        0xDD, 0x83, 0x0D, 0x20, 0x85, 0x4F, 0xC4, 0x6B,
    };
    uint8_t const exp_f5star[6] = {
        0x60, 0x85, 0xA8, 0x6C, 0x6F, 0x63,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_5)
{
    uint8_t const op[16] = {
        0x2D, 0x16, 0xC5, 0xCD, 0x1F, 0xDF, 0x6B, 0x22,
        0x38, 0x35, 0x84, 0xE3, 0xBE, 0xF2, 0xA8, 0xD8,
    };
    uint8_t const k[16] = {
        0x4A, 0xB1, 0xDE, 0xB0, 0x5C, 0xA6, 0xCE, 0xB0,
        0x51, 0xFC, 0x98, 0xE7, 0x7D, 0x02, 0x6A, 0x84,
    };
    uint8_t const rand[16] = {
        0x74, 0xB0, 0xCD, 0x60, 0x31, 0xA1, 0xC8, 0x33,
        0x9B, 0x2B, 0x6C, 0xE2, 0xB8, 0xC4, 0xA1, 0x86,
    };
    uint8_t const exp_f4[16] = {
        0x1C, 0x42, 0xE9, 0x60, 0xD8, 0x9B, 0x8F, 0xA9,
        0x9F, 0x27, 0x44, 0xE0, 0x70, 0x8C, 0xCB, 0x53,
    };
    uint8_t const exp_f5star[6] = {
        0xFE, 0x25, 0x55, 0xE5, 0x4A, 0xA9,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, f4_f5star__3gpp_ts_35_207_v17_0_0__test_set_6)
{
    uint8_t const op[16] = {
        0x1B, 0xA0, 0x0A, 0x1A, 0x7C, 0x67, 0x00, 0xAC,
        0x8C, 0x3F, 0xF3, 0xE9, 0x6A, 0xD0, 0x87, 0x25,
    };
    uint8_t const k[16] = {
        0x6C, 0x38, 0xA1, 0x16, 0xAC, 0x28, 0x0C, 0x45,
        0x4F, 0x59, 0x33, 0x2E, 0xE3, 0x5C, 0x8C, 0x4F,
    };
    uint8_t const rand[16] = {
        0xEE, 0x64, 0x66, 0xBC, 0x96, 0x20, 0x2C, 0x5A,
        0x55, 0x7A, 0xBB, 0xEF, 0xF8, 0xBA, 0xBF, 0x63,
    };
    uint8_t const exp_f4[16] = {
        0xA7, 0x46, 0x6C, 0xC1, 0xE6, 0xB2, 0xA1, 0x33,
        0x7D, 0x49, 0xD3, 0xB6, 0x6E, 0x95, 0xD7, 0xB4,
    };
    uint8_t const exp_f5star[6] = {
        0x1F, 0x53, 0xCD, 0x2B, 0x11, 0x13,
    };
    F4F5STAR_TEST_SET(op, k, rand, exp_f4, exp_f5star);
}

TEST(milenage, milenage__3gpp_ts_35_208_v17_0_0__test_set_1)
{
    uint8_t const k[16] = {
        0x46, 0x5B, 0x5C, 0xE8, 0xB1, 0x99, 0xB4, 0x9F,
        0xAA, 0x5F, 0x0A, 0x2E, 0xE2, 0x38, 0xA6, 0xBC,
    };
    uint8_t const rand[16] = {
        0x23, 0x55, 0x3C, 0xBE, 0x96, 0x37, 0xA8, 0x9D,
        0x21, 0x8A, 0xE6, 0x4D, 0xAE, 0x47, 0xBF, 0x35,
    };
    uint8_t const sqn[6] = {
        0xFF, 0x9B, 0xB4, 0xD0, 0xB6, 0x07,
    };
    uint8_t const amf[2] = {
        0xB9,
        0xB9,
    };
    uint8_t const op_c[16] = {
        0xCD, 0x63, 0xCB, 0x71, 0x95, 0x4A, 0x9F, 0x4E,
        0x48, 0xA5, 0x99, 0x4E, 0x37, 0xA0, 0x2B, 0xAF,
    };
    uint8_t const exp_f1[8] = {
        0x4A, 0x9F, 0xFA, 0xC3, 0x54, 0xDF, 0xAF, 0xB3,
    };
    uint8_t const exp_f1star[8] = {
        0x01, 0xCF, 0xAF, 0x9E, 0xC4, 0xE8, 0x71, 0xE9,
    };
    uint8_t const exp_f2[8] = {
        0xA5, 0x42, 0x11, 0xD5, 0xE3, 0xBA, 0x50, 0xBF,
    };
    uint8_t const exp_f3[16] = {
        0xB4, 0x0B, 0xA9, 0xA3, 0xC5, 0x8B, 0x2A, 0x05,
        0xBB, 0xF0, 0xD9, 0x87, 0xB2, 0x1B, 0xF8, 0xCB,
    };
    uint8_t const exp_f4[16] = {
        0xF7, 0x69, 0xBC, 0xD7, 0x51, 0x04, 0x46, 0x04,
        0x12, 0x76, 0x72, 0x71, 0x1C, 0x6D, 0x34, 0x41,
    };
    uint8_t const exp_f5[6] = {
        0xAA, 0x68, 0x9C, 0x64, 0x83, 0x70,
    };
    uint8_t const exp_f5star[6] = {
        0x45, 0x1E, 0x8B, 0xEC, 0xA4, 0x3B,
    };
    MILENAGE_TEST_SET(op_c, k, rand, sqn, amf, exp_f1, exp_f1star, exp_f2,
                      exp_f3, exp_f4, exp_f5, exp_f5star);
}

TEST(milenage, milenage__3gpp_ts_35_208_v17_0_0__test_set_2)
{
    uint8_t const k[16] = {
        0x46, 0x5B, 0x5C, 0xE8, 0xB1, 0x99, 0xB4, 0x9F,
        0xAA, 0x5F, 0x0A, 0x2E, 0xE2, 0x38, 0xA6, 0xBC,
    };
    uint8_t const rand[16] = {
        0x23, 0x55, 0x3C, 0xBE, 0x96, 0x37, 0xA8, 0x9D,
        0x21, 0x8A, 0xE6, 0x4D, 0xAE, 0x47, 0xBF, 0x35,
    };
    uint8_t const sqn[6] = {
        0xFF, 0x9B, 0xB4, 0xD0, 0xB6, 0x07,
    };
    uint8_t const amf[2] = {
        0xB9,
        0xB9,
    };
    uint8_t const op_c[16] = {
        0xCD, 0x63, 0xCB, 0x71, 0x95, 0x4A, 0x9F, 0x4E,
        0x48, 0xA5, 0x99, 0x4E, 0x37, 0xA0, 0x2B, 0xAF,
    };
    uint8_t const exp_f1[8] = {
        0x4A, 0x9F, 0xFA, 0xC3, 0x54, 0xDF, 0xAF, 0xB3,
    };
    uint8_t const exp_f1star[8] = {
        0x01, 0xCF, 0xAF, 0x9E, 0xC4, 0xE8, 0x71, 0xE9,
    };
    uint8_t const exp_f2[8] = {
        0xA5, 0x42, 0x11, 0xD5, 0xE3, 0xBA, 0x50, 0xBF,
    };
    uint8_t const exp_f3[16] = {
        0xB4, 0x0B, 0xA9, 0xA3, 0xC5, 0x8B, 0x2A, 0x05,
        0xBB, 0xF0, 0xD9, 0x87, 0xB2, 0x1B, 0xF8, 0xCB,
    };
    uint8_t const exp_f4[16] = {
        0xF7, 0x69, 0xBC, 0xD7, 0x51, 0x04, 0x46, 0x04,
        0x12, 0x76, 0x72, 0x71, 0x1C, 0x6D, 0x34, 0x41,
    };
    uint8_t const exp_f5[6] = {
        0xAA, 0x68, 0x9C, 0x64, 0x83, 0x70,
    };
    uint8_t const exp_f5star[6] = {
        0x45, 0x1E, 0x8B, 0xEC, 0xA4, 0x3B,
    };
    MILENAGE_TEST_SET(op_c, k, rand, sqn, amf, exp_f1, exp_f1star, exp_f2,
                      exp_f3, exp_f4, exp_f5, exp_f5star);
}

TEST(milenage, milenage__3gpp_ts_35_208_v17_0_0__test_set_3)
{
    uint8_t const k[16] = {
        0xFE, 0xC8, 0x6B, 0xA6, 0xEB, 0x70, 0x7E, 0xD0,
        0x89, 0x05, 0x75, 0x7B, 0x1B, 0xB4, 0x4B, 0x8F,
    };
    uint8_t const rand[16] = {
        0x9F, 0x7C, 0x8D, 0x02, 0x1A, 0xCC, 0xF4, 0xDB,
        0x21, 0x3C, 0xCF, 0xF0, 0xC7, 0xF7, 0x1A, 0x6A,
    };
    uint8_t const sqn[6] = {
        0x9D, 0x02, 0x77, 0x59, 0x5F, 0xFC,
    };
    uint8_t const amf[2] = {
        0x72,
        0x5C,
    };
    uint8_t const op_c[16] = {
        0x10, 0x06, 0x02, 0x0F, 0x0A, 0x47, 0x8B, 0xF6,
        0xB6, 0x99, 0xF1, 0x5C, 0x06, 0x2E, 0x42, 0xB3,
    };
    uint8_t const exp_f1[8] = {
        0x9C, 0xAB, 0xC3, 0xE9, 0x9B, 0xAF, 0x72, 0x81,
    };
    uint8_t const exp_f1star[8] = {
        0x95, 0x81, 0x4B, 0xA2, 0xB3, 0x04, 0x43, 0x24,
    };
    uint8_t const exp_f2[8] = {
        0x80, 0x11, 0xC4, 0x8C, 0x0C, 0x21, 0x4E, 0xD2,
    };
    uint8_t const exp_f3[16] = {
        0x5D, 0xBD, 0xBB, 0x29, 0x54, 0xE8, 0xF3, 0xCD,
        0xE6, 0x65, 0xB0, 0x46, 0x17, 0x9A, 0x50, 0x98,
    };
    uint8_t const exp_f4[16] = {
        0x59, 0xA9, 0x2D, 0x3B, 0x47, 0x6A, 0x04, 0x43,
        0x48, 0x70, 0x55, 0xCF, 0x88, 0xB2, 0x30, 0x7B,
    };
    uint8_t const exp_f5[6] = {
        0x33, 0x48, 0x4D, 0xC2, 0x13, 0x6B,
    };
    uint8_t const exp_f5star[6] = {
        0xDE, 0xAC, 0xDD, 0x84, 0x8C, 0xC6,
    };
    MILENAGE_TEST_SET(op_c, k, rand, sqn, amf, exp_f1, exp_f1star, exp_f2,
                      exp_f3, exp_f4, exp_f5, exp_f5star);
}
